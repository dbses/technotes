# Redis高可用全景一览

# 一、哨兵机制

所以，如果主库挂了，我们就需要运行一个新主库，比如说把一个从库切换为主库，把它当成主库。在 Redis 主从集群中，哨兵机制是实现主从库自动切换的关键机制。

![Redis哨兵机制](https://technotes.oss-cn-shenzhen.aliyuncs.com/2022/202212111841284.png)

## 2.1 哨兵的职责

哨兵其实就是一个运行在特殊模式下的 Redis 进程，主从库实例运行的同时，它也在运行。哨兵主要负责的就是三个任务：监控、选主（选择主库）和通知。

![哨兵的职责](https://technotes.oss-cn-shenzhen.aliyuncs.com/2022/202212112030551.png)

监控是指哨兵进程在运行时，周期性地给所有的主从库发送 PING 命令，检测它们是否仍然在线运行。如果从库没有在规定时间内响应哨兵的 PING 命令，哨兵就会把它标记为“下线状态”；同样，如果主库也没有在规定时间内响应哨兵的 PING 命令，哨兵就会判定主库下线，然后开始自动切换主库的流程。

选主是指主库挂了以后，哨兵就需要从很多个从库里，按照一定的规则选择一个从库实例，把它作为新的主库。这一步完成后，现在的集群里就有了新主库。

然后，哨兵会执行最后一个任务：通知。在执行通知任务时，哨兵会把新主库的连接信息发给其他从库，让它们执行 replicaof 命令，和新主库建立连接，并进行数据复制。同时，哨兵会把新主库的连接信息通知给客户端，让它们把请求操作发到新主库上。

## 2.2 如何判断主库是否下线？

## 2.3 如何选定新主库？



## 2.4 哨兵集群的高可用



# 小结

本文为个人理解，如有误，欢迎交流指正。公众号【】



推广：年末面试季，Redis的这些高可用特性你能回答全面吗？