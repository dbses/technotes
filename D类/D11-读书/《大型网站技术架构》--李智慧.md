# 第1篇 概述

# 01 | 大型网站架构演化

**大型网站软件系统的特点**

- 高并发，大流量
- 高可用
- 海量数据
- 用户分布广泛，网络情况复杂
- 安全环境恶劣
- 需求快速变更
- 渐进式发展

**大型网站架构演化发展历程**

- 初始阶段的网站架构

![image-20211216151354161](https://gitee.com/yanglu_u/ImgRepository/raw/master/images/20211216151354.png)

- 应用服务和数据服务分离

![image-20211216151151478](https://gitee.com/yanglu_u/ImgRepository/raw/master/images/20211216151151.png)

- 使用缓存改善网站性能

![image-20211216151225003](https://gitee.com/yanglu_u/ImgRepository/raw/master/images/20211216151225.png)

- 使用应用服务器集群改善网站的并发处理能力

![image-20211216151456562](https://gitee.com/yanglu_u/ImgRepository/raw/master/images/20211216151456.png)

- 数据库读写分离

![image-20211216151535082](https://gitee.com/yanglu_u/ImgRepository/raw/master/images/20211216151535.png)

- 使用反向代理和CDN加速网站响应

![image-20211216151632054](https://gitee.com/yanglu_u/ImgRepository/raw/master/images/20211216151632.png)

- 使用分布式文件系统和分布式数据库系统

![image-20211216151746744](https://gitee.com/yanglu_u/ImgRepository/raw/master/images/20211216151746.png)

- 使用NoSQL和搜索引擎

![image-20211216163430332](https://gitee.com/yanglu_u/ImgRepository/raw/master/images/20211216163430.png)

- 业务拆分

![image-20211216163543003](https://gitee.com/yanglu_u/ImgRepository/raw/master/images/20211216163543.png)

- 分布式服务

![image-20211216163646398](https://gitee.com/yanglu_u/ImgRepository/raw/master/images/20211216163646.png)

**网站架构设计误区**

- 一味追随大公司的解决方案
- 为了技术而技术
- 企图用技术解决所有问题

# 02 | 大型网站架构模式

**网站架构模式**

- 分层

将系统在横向维度上切分成几个部分，每个部分负责一部分相对比较单一的职责，然后通过上层对下层的依赖和调用组成一个完整的系统。

- 分割

比如在应用层，将不同业务进行分割，例如将购物、论坛、搜索、广告分割成不同的应用，由独立的团队负责，部署在不同的服务器上；

- 分布式

对于大型网站，分层和分割的一个主要目的是为了切分后的模块便于分布式部署，即将不同模块部署在不同的服务器上，通过远程调用协同工作。

- 集群

多台服务器部署相同应用构成一个集群，通过负载均衡设备共同对外提供服务。

- 缓存

缓存就是将数据存放在距离计算最近的位置以加快处理速度。

- 异步

业务之间的消息传递不是同步调用，而是将一个业务操作分成多个阶段，每个阶段之间通过共享数据的方式异步执行进行协作。

- 冗余

要想保证在服务器宕机的情况下网站依然可以继续服务，不丢失数据，就需要一定程度的服务器冗余运行，数据冗余备份。

- 自动化

在无人值守的情况下网站可以正常运行，一切都可以自动化是网站的理想状态。

- 安全

身份认证、用户信息加密存储、验证码、XSS攻击、SQL注入。

**架构模式在新浪微博的应用**

- 三层架构

![image-20211216225333239](https://gitee.com/yanglu_u/ImgRepository/raw/master/images/20211216225333.png)

（图片来源：http://timyang.net/architecture/weibo/）

- 异步推拉结合的模式

用户发表微博后系统将微博写入消息队列后立即返回，用户响应迅速，消息队列消费者任务将微博推送给所有当前在线粉丝的订阅列表中，非在线用户登录后再根据关注列表拉取微博订阅列表。

- 多级缓存策略

对于微博操作中最常见的“刷微博”操作，几乎全部都是缓存访问操作，可以获得很好的系统性能。

- 多数据中心

用户可以就近访问最近的数据中心以加快访问速度，改善系统性能。

- 自动化

自动化监控，自动化发布，自动化故障修复等。

- 安全

新浪微博在开放平台上使用多级安全审核的策略以保护系统和用户。

# 03 | 大型网站核心架构要素

- 性能
- 可用性
- 伸缩性
- 扩展性
- 安全性

# 第2篇 架构

# 04 | 瞬时响应：网站的高性能架构

**网站性能测试**

不同视角下的网站性能不一样。

性能测试指标、方法、优化策略。

**Web前端性能优化**

- 浏览器访问优化

减少 Http 请求、使用浏览器缓存、启用压缩、CSS 放在页面最上面、JavaScript 放在页面最下面、减少 Cookie 传输。







# 05 | 万无一失：网站的高可用架构





# 06 | 永无止境：网站的伸缩性架构





# 07 | 随机应变：网站的可扩展架构





# 08 | 固若金汤：网站的安全架构

































