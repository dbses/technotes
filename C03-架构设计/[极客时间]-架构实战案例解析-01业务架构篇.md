> 来源：极客时间《架构实战案例解析》

# 01 | 架构的本质：如何打造一个有序的系统？

**架构的本质**

架构的本质是：通过合理的内部编排，保证复杂系统高度有序，能够不断扩展，满足业务和技术的变化。

- 保证复杂系统有序

首先，架构的出发点是业务和技术不断复杂化，引起系统混乱，从而需要通过架构来保证有序。

> 搭一个草房子很简单，可以直接上手；盖一个 2 层楼房，稍微复杂一些，但在工匠的经验 指导下，问题也不大；而盖一座高楼，复杂性就大不一样了，我们需要考虑内部结构、承重、采光、排水、防雷抗震等，这就需要专业人员事先做好整体的架构设计，并严格地按照设计来施工。

可以看到，建筑里的架构不是天然就有的，而是因为建筑越来越复杂，我们需要通过架构来管理这种复杂性，避免建造过程的失控。

软件系统也是如此，从简单的桌面应用发展到现在的大型互联网平台，这个过程中，系统规模越来越大，业务和技术也越来越复杂。我们同样需要通过架构设计，消化复杂性带来的混乱，使系统始终处于一个有序状态，能够应对现有和将来的需求变化。

- 内部编排保证有序

其次，架构实现从无序到有序，是通过合理的内部编排实现的，基本的手段，就是“分”与“合”，先把系统打散，然后将它们重新组合，形成更合理的关系。

“分”就是把系统拆分为各个子系统、模块、组件。我们比较熟悉的微服务架构，就是一种典型的拆分做法。

“合”就是基于业务流程和技术手段，把各个组件有机整合在一起。比如说在微服务架构中，拆分为具体微服务后，我们需要对这些服务进行归类和分层。

> 举个例子，在 Builder 设计模式中，它的主逻辑是将各个部件组装起来，它不关心创建某个具体部件的内部逻辑，它承担的是合的部分；工厂模式负责细粒度的构造逻辑，承担的是分的部分。大家各自管理自己的复杂性。

**架构的分类**

可以分为业务架构、应用架构和技术架构。

> 通常有很多种分法，这只是其中一种。

那么，这些架构分别为谁服务，解决什么问题？

通过一个系统的落地，首先需要人来开发，然后由机器来运行，人和机器共同参与一个系统的落地。

![image-20210720233257939](https://gitee.com/yanglu_u/ImgRepository/raw/master/images/20210720233258.png)

人可能会遇到的问题：业务太复杂，系统后续维护困难；架构追求的是系统概念清晰，业务逻辑容易理解，从而使人可以直观地进行代码开发。

机器可能会遇到的问题：外部请求并发量太大，机器扛不住；架构要求的是系统能够水平扩展，支持硬件容错，保证系统的高性能和高可用。

这里，开发的痛点主要由业务架构和应用架构来解决，机器的痛点主要由技术架构来解决。

- 业务架构

业务架构就是讲清楚核心业务的处理过程，定义各个业务模块的相互关系，它从概念层面帮助我们理解系统面临哪些问题以及如何处理；

- 应用架构

应用架构就是讲清楚系统内部是怎么组织的，有哪些应用，相互间是怎么调用的，它从逻辑层面帮助我们理解系统内部是如何分工与协作的。

- 技术架构

技术架构就是讲清楚系统由哪些硬件、操作系统和中间件组成，它们是如何和我们开发的应用一起配合，应对各种异常情况，保持系统的稳定可用。它从物理层面帮助我
们理解系统是如何构造的，以及如何解决稳定性的问题。

> 举一个电商的例子。
>
> 比如一个商品业务，可能对应 3 个应用，一个前台商 品展示应用、一个后台商品管理应用，以及一个商品基础服务。
>
> 业务架构定义了一个下单的具体流程；应用架构定义了下单有哪些应用参与以及它们如何协作；技术架构要保障相关的应用能够处理高并发，从而保证大促顺利进行。

> 举一个拍电影的例子。
>
> 业务架构定义了这个电影的故事情节和场景安排；应用架构定义了有哪些角色及其职责，在每个场景中，这些角色是如何互动的；技术架构确定这些角色由谁来表演，物理场景上是怎么布置的，以此保证整个拍摄能够顺利完成。

**什么是好的架构？**

一个好的架构必须满足两方面挑战：业务复杂性和技术复杂
性。

- 业务复杂性

系统架构首先要满足当前的业务需求，还要满足将来的业务需求，系统要能不断地扩展变化，包括调整现有功能，以及增加新功能。（扩展性）

而且，系统的功能变化不能影响现有业务，不要牵一发动全身。因此，在架构设计上，要做到系统的柔性可扩展，能够根据业务变化做灵活的调整。（扩展性）

此外，上新业务功能，需要短时间就能落地。因此，架构设计上，还要做到系统功能的可重用，这样才能通过快速复用，实现业务敏捷和创新。（可重用）

- 技术复杂性

要保证一个业务能正常运行，还要保证这个系统稳定可用。

一个复杂系统是由很多部分组成的，如应用程序、服务器、数据库、网络、中间件等，都可能会出问题。那怎么在出问题时，能够快速恢复系统或者让备用系统顶上去呢?（高可用）

还有流量问题，平时流量不大，少量机器就可以处理，但在大促的时候，大量流量进来，系统是不是能够通过简单地加机器方式就能支持呢?（高并发）

此外还有低成本的问题，系统能否做到，使用廉价设备而不是高大上的 IOE 设备，使用免费的开源组件而不是昂贵的商业套件，使用虚拟化技术而不是物理机。（低成本）

**什么是好的架构师？**

一个优秀的架构师，应具备很强的综合能力。

![image-20210720225454505](https://gitee.com/yanglu_u/ImgRepository/raw/master/images/20210720225454.png)

- 抽象思维

抽象思维是架构师最重要的能力， 架构师要善于把实物概念化并归类。比如，面对一个大型的 B2C 网站，能够迅速抽象为采购 -> 运营 -> 前台搜索 -> 下单 -> 履单这几大模块，对系统分而治之。

- 透过问题看本质

透过问题看本质是由事物的表象到实质，往深层次挖掘。比如，看到一段 Java 代码，知道它在 JVM 中如何执行；一个跨网络调用，知道数据是如何通过各种介质（比如网卡端口）到达目标位置。

- 多领域知识和技术前瞻性

架构师要有技术的广度（多领域知识）和深度（技术前瞻）。对主流公司的系统设计非常了解，知道优劣长短，碰到实际问题，很快就能提供多种方案供评估。

- 沟通交流

能落地的架构才是好架构，架构师还需要具备良好的沟通能力，能确保各方对架构达成共识，愿意采取一致的行动。

- 平衡取舍

良好的平衡取舍能力，可以确保架构在现有资源约束下是最合理的，能让理想最终照进现实。

# 02 | 业务架构：作为开发，你真的了解业务吗？

我们知道，项目的开发都是从收集业务需求开始的，原始的需求一般来自于最终用户。但是，每个用户其实只清楚自己所负责的那部分，因此这些原始需求往往是零散的，特别是当一个业务流程跨多个部门的时候，更没有一个人能够说清楚这个业务的全貌。

所以说，仅仅基于这些原始的需求来指导开发是远远不够的，这时，就需要产品经理和架构师介入进来，填补这段空白。

**产品经理的职责**

产品经理的职责就是：告诉用户，系统长什么样子；告诉开发，他要实现什么功能。

具体需要做什么呢？

- 梳理出业务流程

首先，收集用户的原始需求，然后，将它们梳理成一个个业务流程。

> 业务流程包括输入、输出和业务功能

比如说，一个典型的购物流程，包括商品浏览、商品加入购物车、下单、支付等步骤。

![image-20210722231719861](https://gitee.com/yanglu_u/ImgRepository/raw/master/images/20210722231720.png)

其中，下单步骤的输入，就是订单的各种信息，下单的功能，就是整合这些信息，创建一个具体的订单，而下单的输出结果，就是新创建的订单。

- 定义用户界面

把每个步骤具体化为页面原型。在原型中，会直观的给出各个步骤的输入或输出，以及用户的操作过程，最后再把这些页面串起来，形成一个业务流程。

总的来说，产品经理定义了系统的外表。把大量零散的原始需求经过梳理和关联，变成一系列有序的业务流程。

这些产出已经足够让用户知道，系统长什么样子了。但对于开发者来说，要实现什么功能？这些还远远不够，因为他们需要能进一步看到系统的内部结构。

而这一步，就是业务架构师要做的事情。

**业务架构师的职责**

我们设计一个购物流程模块，里面包含商品查询、添加购物车、 下单和支付接口，来分别对应流程里的 4 个业务步骤。

以这样的方式构建系统，表面上看起来，业务和系统的映射好像非常简单，但在实际中，落地的难度却非常大。

- 难点一：掌握不同模块的业务和数据模型

比如说要实现一个小小的购物流程模块，就要同时涉及商品、购物车、下单和支付四个业务，模块的开发者要同时非常清楚这四部分的数据模型和业务逻辑。

- 难点二：业务改动难度大

如果一个业务领域的需求发生了变化，比如说，订单要增加一个新的状态，那么所有涉及该订单的模块都要知道这个变化，并要做出相应的调整。这就要求，每个开发者都是全知全能的，对所有业务都了如指掌。

那面对这样的业务，我们通常有哪些落地方法？

- 方法一：按业务流程来拆分业务

先把所有的业务流程拆散，这样得到了一堆业务节点；然后把业务节点进行归类，相关的业务节点放在同一个系统模块里。

![image-20210723000411735](https://gitee.com/yanglu_u/ImgRepository/raw/master/images/20210723000411.png)

这种按照业务流程来拆分系统模块，对应关系比较直接，但实现起来很困难。

> 因为流程的条数是更难控制的，很容易陷入面向过程开发。

- 方法二：按业务域来拆分业务

在实际业务场景中，一个业务节点可能会涉及不同业务领域的功能。

比如说，一个下单节点，会涉及到获取商品信息、获取用户信息、扣库存、下订单等多个业务功能，那么你就可以进一步分解这个节点的功能，把不同的功能分到对应的业务域和系统模块。

基于业务域，构建了系统模块后，我们就可以按照这样的方式还原整个业务流程，比如上面的购物流程例子，我们就可以这样还原它：

```text
购物流程 = 商品模块.商品搜索 + 购物车模块.添加商品 + 订单模块.创建订单 + 支付模块.支付
```

如果你把这个定义画成序列图，就很直观和容易理解，也比较符合开发人员思维，系统实现起来非常容易。通过这种系统模块之间的不同功能组合，我们很容易给出各个业务流程的定义。

至此，我们对业务架构师应该有一个认识了。

业务架构师的工作，就是把业务流程和节点打散，按照业务域的维度来划分系统模块，并定义这些模块之间的关系，最终形成一个高度结构化的模块体系。这样， 开发人员既容易理解业务，又方便落地系统。

> 产品经理和业务架构师的工作既有区别又有联系，简单地说，产品经理定义了系统的外观，满足了用户；
>
> 业务架构师在此基础上，进一步定义了系统的内部模块结构，满足了开发人员。

**架构目标之一：业务的可扩展**



**架构目标之二：业务的可复用**





