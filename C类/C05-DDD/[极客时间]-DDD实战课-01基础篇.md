> 来源极客时间《DDD实战课》--欧创新

# 开篇词 | 学好了DDD，你能做什么？

要想应用 DDD，首要任务就是要吃透 DDD 的核心设计思想，搞清楚 DDD、微服务和中台之间的关系。

DDD 是一种设计思想，它可以同时指导中台业务建模和微服务设计。其次，就是通过战略设计，建立领域模型，划分微服务边界。最后，通过战术设计，从领域模型转向微服务设计和落地。

遵循以上过程，这门课的设计思路也就诞生了。

专栏所能带来的收获：

1. **概念思想**：了解 DDD 必知必会的 10 大核心概念，深入设计思想；
2. **微服务架构**：弄懂微服务架构各层之间的关系，深化微服务架构设计原则和注意事项；
3. **领域/中台建模**：完成领域建模和企业级中台业务建模；
4. **技术要点**：学习 DDD 在领域模型和微服务设计过程中的技术要点；

**基础篇**

主要讲解 DDD 的核心知识体系，具体包括：领域、子域、核心域、通用域、支撑域、限界上下文、实体、值对象、聚合和聚合根等概念。

![image-20211109221143097](https://gitee.com/yanglu_u/ImgRepository/raw/master/images/20211109221143.png)

**进阶篇**

主要讲解领域事件、DDD 分层架构、几种常见的微服务架构模型以及中台设计思想等内容。具体包括：

- 如何通过领域事件实现微服务解耦？
- 怎样进行微服务分层设计？
- 如何实现层与层之间的服务协作？
- 通过几种微服务架构模型的对比分析，让你了解领域模型和微服务分层的作用和价值。
- 如何实现前中后台的协同和融合？如何利用 DDD 进行中台设计？

**实战篇**

- 中台和领域建模的实战
- 微服务设计实战

# 01 | 领域驱动设计：微服务设计为什么要选择DDD？

我经常看到项目团队为微服务到底应该拆多小而争得面红耳赤。那是否有合适的理论或设计方法来指导微服务设计呢？

答案就是 DDD。

**微服务设计和拆分的困境**

在微服务实践过程中产生了不少的争论和疑惑：微服务的粒度应该多大呀？微服务到底应该如何拆分和设计呢？微服务的边界应该在哪里？

我想这两年，你在技术圈中一定听说过一些项目因为前期微服务拆分过度，导致项目复杂度过高，无法上线和运维。

综合来看，微服务拆分困境产生的根本原因就是不知道业务或者微服务的边界到底在什么地方。如果确定了业务边界和应用边界，这个困境也就迎刃而解了。

**为什么 DDD 适合微服务？**

DDD 是一种处理高度复杂领域的设计思想，包括战略设计和战术设计两部分。

战略设计主要从业务视角出发，建立业务领域模型，划分领域边界，建立通用语言的限界上下文，限界上下文可以作为微服务设计的参考边界。

战术设计则从技术视角出发，侧重于领域模型的技术实现，完成软件开发和落地，包括：聚合根、实体、值对象、领域服务、应用服务和资源库等代码逻辑的设计和实现。

我们不妨来看看 DDD 是如何进行战略设计的。

![image-20211109222811532](https://gitee.com/yanglu_u/ImgRepository/raw/master/images/20211109222811.png)

第一步：在事件风暴中梳理出领域实体等领域对象。

第二步：将业务紧密相关的实体进行组合形成聚合。聚合后它们仍在同一个微服务实例中运行，这个边界是逻辑边界，所以用虚线表示。

第三步：将一个或者多个聚合划定在一个限界上下文内，形成领域模型。这一层边界就是未来微服务的边界。

有了这两层边界，微服务的设计就不是什么难事了。

**DDD 与微服务的关系**

DDD 是一种架构设计方法，微服务是一种架构风格。

- 相同

两者从本质上都是为了追求高响应力，而从业务视角去分离应用系统建设复杂度的手段。

两者都强调从业务出发，其核心要义是强调根据业务发展，合理划分领域边界，持续调整现有架构，优化现有代码，以保持架构和代码的生命力，也就是我们常说的演进式架构。

- 不同

DDD 主要关注：从业务领域视角划分领域边界，建立领域模型。

微服务主要关注：运行时的进程间通信、容错和故障隔离，关注微服务的独立开发、测试、构建和部署。

# 02 | 领域、子域、核心域、通用域和支撑域

**如何理解领域和子域？**

在研究和解决业务问题时，DDD 会按照一定的规则将业务领域进行细分，当领域细分到一定的程度后，DDD 会将问题范围限定在特定的边界内，在这个边界内建立领域模型。

领域可以进一步划分为子领域，称为子域，每个子域对应一个更小的问题域或更小的业务范围。

DDD 的研究方法与自然科学的研究方法类似。当人们在自然科学研究中遇到复杂问题时，通常的做法就是将问题一步一步地细分，再针对细分出来的问题域，逐个深入研究，探索和建立所有子域的知识体系。当所有问题子域完成研究时，我们就建立了全部领域的完整知识体系了。

![image-20211110223702072](https://gitee.com/yanglu_u/ImgRepository/raw/master/images/20211110223702.png)

上面这张图是在讲如何给桃树建立一个完整的生物学知识体系。初中生物课其实早就告诉我们研究方法了。它的研究过程是这样的。

第一步：确定研究对象，即研究领域，这里是一棵桃树。

第二步：对研究对象进行细分，将桃树细分为器官。

第三步：对器官进行细分，将器官细分为组织。。

第四步：对组织进行细分，将组织细分为细胞，细胞成为我们研究的最小单元。细胞之间的细胞壁确定了单元的边界，也确定了研究的最小边界。

**如何理解核心域、通用域和支撑域？**

子域可以根据自身重要性和功能属性划分为三类，它们分别是：核心域、通用域和支撑域。

- 决定产品和公司核心竞争力的子域是核心域。
- 没有太多个性化的诉求，同时被多个子域使用的是通用域。
- 既不包含决定产品和公司核心竞争力的功能，也不包含通用功能的子域，它就是支撑域。

举例来说，通用域是你需要用到的通用系统，比如认证、权限等等，这类应用很容易买到，没有企业特点限制，不需要做太多的定制化。而支撑域则具有企业特性，但不具有通用性，例如数据代码类的数据字典等系统。

那为什么要划分核心域、通用域和支撑域，主要目的是什么呢？

公司在 IT 系统建设过程中，由于预算和资源有限，对不同类型的子域应有不同的关注度和资源投入策略。

# 03 | 限界上下文：定义领域边界的利器

在 DDD 领域建模和系统建设过程中，有很多的参与者，包括领域专家、产品经理、项目经理、架构师、开发经理和测试经理等。

对同样的领域知识，不同的参与角色可能会有不同的理解，那大家交流起来就会有障碍，怎么办呢？因此，在 DDD 中就出现了“通用语言”和“限界上下文”这两个重要的概念。

**什么是通用语言？**

在事件风暴过程中，通过团队交流达成共识的，能够简单、清晰、准确描述业务涵义和规则的语言就是通用语言。

也就是说，通用语言是团队统一的语言，不管你在团队中承担什么角色，在同一个领域的软件生命周期里都使用统一的语言进行交流。

下面是一个微服务设计实例的部分数据，表格中的这些名词术语就是项目团队在事件风暴过程中达成一致、可用于团队内部交流的通用语言。

![image-20220123210103685](https://gitee.com/yanglu_u/img2022/raw/master/learn/20220123210103.png)

**什么是限界上下文？**

我们知道语言都有它的语义环境，同样，通用语言也有它的上下文环境。为了避免同样的概念或语义在不同的上下文环境中产生歧义，DDD 在战略设计上提出了“限界上下文”这个概念，用来确定语义所在的领域边界。

我们可以将限界上下文拆解为两个词：限界和上下文。限界就是领域的边界，而上下文则是语义环境。通过领域的限界上下文，我们就可以在统一的领域边界内用统一的语言进行交流。

**进一步理解限界上下文**

正如电商领域的商品一样，商品在不同的阶段有不同的术语，在销售阶段是商品，而在运输阶段则变成了货物。同样的一个东西，由于业务领域的不同，赋予了这些术语不同的涵义和职责边界，这个边界就可能会成为未来微服务设计的边界。

看到这，我想你应该非常清楚了，领域边界就是通过限界上下文来定义的。

**限界上下文和微服务的关系**

车险承保的流程包含了投保、缴费、出单等几个主要流程。如果出险了还会有报案、查勘、定损、理算等理赔流程。

![image-20220123220849741](https://gitee.com/yanglu_u/img2022/raw/master/learn/20220123220849.png)

子域可能会包含多个限界上下文，如理赔子域就包括报案、查勘和定损等多个限界上下文。也有可能子域本身的边界就是限界上下文边界，如投保子域。

理论上限界上下文就是微服务的边界。我们将限界上下文内的领域模型映射到微服务，就完成了从问题域到软件的解决方案。

# 04 | 实体和值对象：从领域模型的基础单元看系统设计











